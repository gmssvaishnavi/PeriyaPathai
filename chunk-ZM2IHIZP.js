import{a as L}from"./chunk-NVL3L3HZ.js";import{$a as k,Cb as F,Ma as _,Na as x,Oa as w,Pa as y,Q as v,Qa as S,Sa as s,Ta as a,V as O,Va as E,W as P,Wa as M,Xa as l,a as h,aa as f,ab as I,b as u,bb as m,cb as C,fb as T,oa as d,qb as z,ya as b}from"./chunk-DKZNZJOI.js";var $=(t,i)=>i.title;function H(t,i){t&1&&(s(0,"div",3),m(1,"Loading songs..."),a())}function j(t,i){if(t&1&&(s(0,"div",4),m(1),a()),t&2){let o=l();d(),C(o.mediaService.error())}}function N(t,i){if(t&1&&(s(0,"p"),m(1),a()),t&2){let o=i.$implicit;I(o.type),d(),C(o.text)}}function V(t,i){if(t&1&&(s(0,"div",11),y(1,N,2,3,"p",13,w),a()),t&2){let o=l(2).$implicit,e=l(2);d(),S(e.formatLyrics(e.songContents()[o.title]))}}function A(t,i){t&1&&(s(0,"div",12),m(1,"Loading lyrics..."),a())}function B(t,i){if(t&1&&(s(0,"div",10),_(1,V,3,0,"div",11)(2,A,2,0,"div",12),a()),t&2){let o=l().$implicit,e=l(2);d(),x(e.songContents()[o.title]?1:2)}}function D(t,i){if(t&1){let o=E();s(0,"div",6)(1,"div",8),M("click",function(){let n=O(o).$implicit,r=l(2);return P(r.toggleSong(n.title))}),s(2,"h3"),m(3),a(),s(4,"span",9),m(5," \u25B6 "),a()(),_(6,B,3,1,"div",10),a()}if(t&2){let o=i.$implicit,e=l(2);d(3),C(o.title),d(),k("expanded",e.expandedSongs().has(o.title)),d(2),x(e.expandedSongs().has(o.title)?6:-1)}}function G(t,i){t&1&&(s(0,"div",7)(1,"p"),m(2,"No songs found for your search."),a()())}function J(t,i){if(t&1&&(s(0,"div",5),y(1,D,7,4,"div",6,$,!1,G,3,0,"div",7),a()),t&2){let o=l();d(),S(o.filteredTextItems())}}var W=(()=>{let i=class i{constructor(){this.mediaService=v(L),this.http=v(z),this.expandedSongs=f(new Set),this.songContents=f({}),this.loadingContent=f(!1),this.searchTerm=f(""),this.textItems=T(()=>this.mediaService.mediaItems().filter(e=>e.type==="text")),this.filteredTextItems=T(()=>{let e=this.searchTerm().toLowerCase();return this.textItems().filter(n=>n.title.toLowerCase().includes(e))})}ngOnInit(){this.mediaService.mediaItems().length===0&&this.mediaService.fetchMedia()}onSearchInput(e){let n=e.target;this.searchTerm.set(n.value)}toggleSong(e){let n=new Set(this.expandedSongs());n.has(e)?n.delete(e):(n.add(e),this.loadSongContent(e)),this.expandedSongs.set(n)}loadSongContent(e){let n=this.textItems().find(r=>r.title===e);!n||this.songContents()[e]||(this.loadingContent.set(!0),this.http.get(n.url,{responseType:"text"}).subscribe({next:r=>{this.songContents.update(p=>u(h({},p),{[e]:r})),this.loadingContent.set(!1)},error:()=>{this.songContents.update(r=>u(h({},r),{[e]:"Failed to load content"})),this.loadingContent.set(!1)}}))}formatLyrics(e){if(!e)return[];let n=this.decodeHtml(e),r=n.match(/\{\s*\d+\s*,\s*"([^"]+)"\s*\}/g);if(r)return r.map(c=>{let g=c.match(/\{\s*(\d+)\s*,\s*"([^"]+)"\s*\}/);return g?{text:`${g[1]}. ${g[2]}`,type:"line"}:{text:"",type:"empty"}});let p=n;try{let c=JSON.parse(n);c&&typeof c=="object"&&c.song&&(p=Array.isArray(c.song)?c.song.join(`
`):c.song)}catch{}return p.split(`
`).map(c=>{let g=c.trim();return g===""?{text:"",type:"empty"}:/^\d+\./.test(g)?{text:g,type:"stanza-header"}:{text:g,type:"line"}})}decodeHtml(e){let n=document.createElement("textarea");return n.innerHTML=e,n.value}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=b({type:i,selectors:[["app-text"]],decls:8,vars:1,consts:[[1,"text-container"],[1,"search-container"],["type","text","placeholder","Search for a song...",1,"search-input",3,"input"],[1,"loading"],[1,"error"],[1,"songs-list"],[1,"song-card"],[1,"no-results"],[1,"song-header",3,"click"],[1,"toggle-icon"],[1,"song-content"],[1,"lyrics"],[1,"loading-song"],[3,"class"]],template:function(n,r){n&1&&(s(0,"div",0)(1,"h2"),m(2,"Songs & Lyrics"),a(),s(3,"div",1)(4,"input",2),M("input",function(c){return r.onSearchInput(c)}),a()(),_(5,H,2,0,"div",3)(6,j,2,1,"div",4)(7,J,4,1,"div",5),a()),n&2&&(d(5),x(r.mediaService.loading()||r.loadingContent()?5:r.mediaService.error()?6:7))},dependencies:[F],styles:["[_nghost-%COMP%]{display:block;font-family:Helvetica Neue,sans-serif;background-color:#f4f7f6}.text-container[_ngcontent-%COMP%]{padding:2rem;max-width:800px;margin:2rem auto;background:transparent}h2[_ngcontent-%COMP%]{text-align:center;color:#2c3e50;margin-bottom:2.5rem;font-size:2.8rem;font-weight:300;letter-spacing:-1px}.loading[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{text-align:center;padding:3rem 2rem;font-size:1.2rem;color:#7f8c8d;background-color:#fff;border-radius:12px;box-shadow:0 2px 10px #0000000d}.error[_ngcontent-%COMP%]{color:#e74c3c}.songs-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.song-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 4px 12px #00000014;overflow:hidden;transition:all .4s cubic-bezier(.25,.8,.25,1);border:1px solid #eef}.song-card[_ngcontent-%COMP%]:hover{box-shadow:0 8px 25px #0000001f;transform:translateY(-2px)}.song-header[_ngcontent-%COMP%]{padding:1.5rem 2rem;background:linear-gradient(135deg,#27ae60,#2ecc71);color:#fff;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:background-color .3s ease}.song-header[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#229954,#28b463)}.song-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.4rem;font-weight:500}.toggle-icon[_ngcontent-%COMP%]{font-size:1.2rem;transition:transform .4s cubic-bezier(.25,.8,.25,1);transform-origin:center;color:#fffc}.toggle-icon.expanded[_ngcontent-%COMP%]{transform:rotate(90deg);color:#fff}.song-content[_ngcontent-%COMP%]{padding:2.5rem;background:#fafcff;border-top:1px solid #eef}.lyrics[_ngcontent-%COMP%]{font-family:Georgia,serif;line-height:1.9;color:#34495e}.lyrics[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;padding:0}.lyrics[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:700;text-align:center;margin-bottom:2rem;color:#2c3e50}.lyrics[_ngcontent-%COMP%]   .stanza-header[_ngcontent-%COMP%]{font-weight:700;margin-top:1.5rem;color:#2c3e50;font-size:1.2rem}.lyrics[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{font-size:1.15rem;margin-left:1.5rem;line-height:2}.lyrics[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{height:1.2rem}.loading-song[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#95a5a6;font-style:italic;font-size:1.1rem}"]});let t=i;return t})();export{W as TextComponent};
